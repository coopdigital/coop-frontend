{% import '/shared-component--signpost/src/signpost.html' as signpost %}
{% macro render(content, cms) %}

{% set mediaClass = '' %}
{% set squircleClass = '' %}
{% set contentPullClass = '' %}
{% set squircleBgColour = '' %}

{% if content.image %}
  {% set mediaClass = 'coop-c-hero--media' %}
{% endif %}

{% if content.contentPull %}
  {% set contentPullClass = 'coop-c-hero--pull' %}
{% endif %}

{% if content.showSquircle == true %}
  {% set squircleClass = 'coop-c-hero--squircle' %}
{% endif %}

{% if content.background and content.background.class  %}
  {% set squircleBgColour = content.background.class %}
{% endif %}

<div class="coop-c-hero {{ squircleClass }} {{ mediaClass }} {{ contentPullClass }}">
  <div class="coop-c-hero__inner">

    {% if content.heading %}
      <h1 class="coop-c-hero__title">{{ content.heading }}</h1>
    {% endif %}

    {% if content.image %}
      {% with image = cms.get_asset(content.image.sys.id) %}

      {% if image.data.fields.description %}
        {% set altText = image.data.fields.description %}
      {% else %}
        {% set altText = image.data.fields.title %}
      {% endif %}

      <div class="coop-c-hero__media">
        <picture class="coop-c-hero__image">

          {%- set imageType = image.fields.file.contentType.split('/')[1] -%}
            {%- if imageType == 'jpeg' -%}
            {%- set imageType = 'jpg' -%}
          {%- endif -%}
          
          <source media="(min-width: 60em)"
            srcset="{{ image.fields.file.url }}?fm=webp&amp;q=60&amp;w=600&amp;h=338 1x,
                    {{ image.fields.file.url }}?fm=webp&amp;q=60&amp;w={{ 600 * 2 }}&amp;h={{ 338 * 2 }} 2x" type="image/webp" />
          <source
            srcset="{{ image.fields.file.url }}?fm=webp&amp;q=60&amp;w=600&amp;h=338 1x,
                    {{ image.fields.file.url }}?fm=webp&amp;q=60&amp;w={{ 600 * 2 }}&amp;h={{ 338 * 2 }} 2x"
            type="image/webp" />

          <source media="(min-width: 60em)"
            srcset="{{ image.fields.file.url }}?fm={{imageType}}&amp;q=60&amp;w=600&amp;h=338 1x,
                    {{ image.fields.file.url }}?fm={{imageType}}&amp;q=60&amp;w={{ 600 * 2 }}&amp;h={{ 338 * 2 }} 2x"
            type="image/jpeg" />
          <source
            srcset="{{ image.fields.file.url }}?fm={{imageType}}&amp;q=60&amp;w=600&amp;h=338 1x,
                    {{ image.fields.file.url }}?fm={{imageType}}&amp;q=60&amp;w={{ 600 * 2 }}&amp;h={{ 338 * 2 }} 2x"
            type="image/jpeg" />

          <img src="{{ image.fields.file.url }}?fm={{imageType}}&amp;q=60&amp;w=600&amp;h=338" width="600"
            height="338" alt="{{ altText }}" />
        </picture>
      </div>
      {% endwith %}
    {% endif %}

    {% if content.bodyText or content.link %}
    <div class="coop-c-hero__body">
      {% if content.bodyText %}
        {{ content.bodyText | markdown }}
      {% endif %}
      {% if content.link %}
        {% with link = cms.get_entry(content.link.sys.id) %}
          {%- set href = {} -%}
          {% if link.type == 'internalLink' %}
            {% if link.data.fields.page %}
              {% with internalLink = cms.get_entry(link.data.fields.page.sys.id) %}
                {%- set _ = href.update({"url" : tenant_url_path + internalLink.full_url_path}) -%}
              {% endwith %}
          {% endif %}
          {% else %}
            {%- set _ = href.update({"url" : link.fields.url.data }) -%}
          {% endif %}
          <div class="coop-c-hero__link">
            <a href="{{href.url}}" class="coop-t-link" data-contenttype="Membership hero" data-contentparent="{{content.heading}}" data-linktext="{{link.fields.title.data}}">{{link.fields.title.data|safe}}</a>
          </div>
        {% endwith %}
      {% endif %}
    </div>
    {% endif %}
    {% if content.showSquircle == true %}
    <div class="coop-c-hero__squircle" aria-hidden="true">
      <div class="coop-c-hero__squircle__inner ">
        <svg class="coop-c-hero__squircle__svg {{squircleBgColour}}" viewBox="0 0 1802 1726">
          <path class="coop-c-hero__squircle__path"
            d="M1743 446.3c-49.7-167.6-173.7-299.6-339.6-362C1079.6-28.2 724.1-28.2 397 84.9 232.6 146.7 109.2 278.6 58.5 446.8 19.7 581.6 0 721.4 0 862.8s19.7 281.2 58.5 416.5c50.8 167.6 174.2 299.6 339.6 362 162.2 56.2 331.5 84.7 502.9 84.7 172 0 341.3-28.4 504-85.2 164.9-62.4 288.3-193.8 338-362 39.4-135.8 59-275.6 59-416s-19.7-280.6-59-416.5z" />
        </svg>
      </div>
    </div>
    {% endif %}
  </div>
</div>
{% endmacro %}
